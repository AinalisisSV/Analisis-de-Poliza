<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Analizador de Pólizas con IA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f5f5f7;
      --surface: #ffffff;
      --border-subtle: #e5e5e7;
      --border-strong: #d4d4d8;
      --text-main: #111827;
      --text-soft: #6b7280;
      --accent: #111827;
      --accent-soft: #f3f4f6;
      --radius-lg: 18px;
      --radius-md: 12px;
      --transition: 0.22s ease-out;
      --shadow-soft: 0 14px 40px rgba(15,23,42,0.06);
      --font: "Inter", system-ui, -apple-system, -sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: var(--font);
      background: var(--bg);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 32px 16px;
    }

    .shell {
      width: 100%;
      max-width: 1120px;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.8fr);
      gap: 24px;
      align-items: stretch;
    }

    /* Lateral: marca y propuesta */
    .side {
      padding: 20px 20px 18px;
      border-radius: var(--radius-lg);
      background: var(--surface);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid var(--border-subtle);
      font-size: 10px;
      color: var(--text-soft);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .title {
      font-size: 24px;
      line-height: 1.3;
      font-weight: 600;
      color: var(--text-main);
    }

    .title span {
      font-weight: 400;
      color: var(--text-soft);
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-soft);
      line-height: 1.7;
      max-width: 320px;
    }

    .list {
      margin-top: 4px;
      display: grid;
      gap: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .list-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .list-bullet {
      width: 8px;
      height: 8px;
      border-radius: 2px;
      background: var(--accent);
    }

    .note-box {
      margin-top: 8px;
      padding: 10px 10px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .note-label {
      font-size: 10px;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .note-main {
      font-size: 12px;
      color: var(--text-main);
      font-weight: 500;
    }

    .note-sub {
      font-size: 10px;
      color: var(--text-soft);
    }

    .footnote {
      margin-top: auto;
      font-size: 9px;
      color: var(--text-soft);
    }

    /* Panel derecho: funcional */
    .panel {
      padding: 18px 16px 14px;
      border-radius: var(--radius-lg);
      background: var(--surface);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .panel-title-wrap {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .panel-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-main);
    }

    .panel-subtitle {
      font-size: 10px;
      color: var(--text-soft);
    }

    .badge {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 9px;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .uploader {
      padding: 10px 10px 8px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-strong);
      background: #fafafa;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .uploader-label {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-main);
    }

    .uploader-text {
      font-size: 9px;
      color: var(--text-soft);
    }

    .uploader-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 3px;
    }

    input[type="file"] {
      font-size: 9px;
      color: var(--text-soft);
      max-width: 210px;
    }

    .btn {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid var(--accent);
      background: var(--accent);
      color: #ffffff;
      font-size: 9px;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all var(--transition);
    }

    .btn:hover {
      background: #000000;
      border-color: #000000;
      box-shadow: 0 10px 26px rgba(15,23,42,0.14);
      transform: translateY(-1px);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    #uploadStatus {
      font-size: 9px;
      color: #16a34a;
    }

    #uploadError {
      font-size: 9px;
      color: #b91c1c;
    }

    .chat-label {
      margin-top: 2px;
      font-size: 9px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
    }

    .chat-label strong {
      font-size: 10px;
      color: var(--text-main);
      font-weight: 500;
    }

    #noPolicy {
      display: none;
      font-size: 9px;
      color: #b45309;
      margin-top: 4px;
    }

    #chat {
      margin-top: 6px;
      padding: 8px;
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      background: #fdfdfd;
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 260px;
      overflow-y: auto;
    }

    .msg {
      padding: 7px 9px;
      border-radius: 10px;
      font-size: 9.5px;
      line-height: 1.5;
      max-width: 80%;
      border: 1px solid transparent;
      white-space: pre-line;
    }

    .msg.bot {
      background: #ffffff;
      border-color: var(--border-subtle);
      color: var(--text-soft);
    }

    .msg.user {
      margin-left: auto;
      background: var(--accent);
      color: #ffffff;
      border-color: var(--accent);
    }

    .composer {
      margin-top: 6px;
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto;
      gap: 8px;
      align-items: flex-end;
    }

    textarea {
      width: 100%;
      resize: none;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      font-size: 9.5px;
      color: var(--text-main);
      outline: none;
      transition: all var(--transition);
      box-shadow: 0 8px 22px rgba(15,23,42,0.04);
    }

    textarea::placeholder {
      color: #9ca3af;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 12px 30px rgba(15,23,42,0.08);
      transform: translateY(-1px);
    }

    .typing {
      display: none;
      margin-top: 2px;
      font-size: 8px;
      color: var(--text-soft);
    }

    .typing span {
      display: inline-block;
      width: 3px;
      height: 3px;
      margin-right: 2px;
      border-radius: 999px;
      background: #9ca3af;
      animation: pulse 0.9s infinite alternate;
    }

    .typing span:nth-child(2) { animation-delay: 0.16s; }
    .typing span:nth-child(3) { animation-delay: 0.32s; }

    @keyframes pulse {
      from { opacity: 0.4; transform: translateY(0); }
      to   { opacity: 1;   transform: translateY(-1px); }
    }

    @media (max-width: 880px) {
      body { padding: 20px 10px; }
      .shell {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- Columna izquierda -->
    <aside class="side">
      <div class="pill">
        <div class="pill-dot"></div>
        Policy Intelligence · Demo
      </div>
      <h1 class="title">
        Analizador de pólizas con IA
        <span>orientado a práctica profesional.</span>
      </h1>
      <p class="subtitle">
        Interfaz discreta y neutra para integrar lectura de pólizas y consultas inteligentes
        en un flujo que podés escalar a clientes, despachos o brokers.
      </p>
      <div class="list">
        <div class="list-item">
          <div class="list-bullet"></div>
          <div>Upload de póliza y sesión de chat en una sola vista.</div>
        </div>
        <div class="list-item">
          <div class="list-bullet"></div>
          <div>Listo para conectar a tu backend seguro con file search.</div>
        </div>
        <div class="list-item">
          <div class="list-bullet"></div>
          <div>Estructura pensada para modelo de suscripción multiusuario.</div>
        </div>
      </div>
      <div class="note-box">
        <div class="note-label">Base operativa</div>
        <div class="note-main">Un solo punto de acceso para tus clientes.</div>
        <div class="note-sub">
          El frontal se mantiene estático y liviano; la lógica crítica vive en tu infraestructura.
        </div>
      </div>
      <div class="footnote">
        Esta demo no expone llaves ni lógica sensible. Lo siguiente es conectar tu API privada.
      </div>
    </aside>

    <!-- Columna derecha -->
    <section class="panel">
      <div class="panel-header">
        <div class="panel-title-wrap">
          <div class="panel-title">Póliza + Chat</div>
          <div class="panel-subtitle">Flujo simple: subir documento, consultar, responder.</div>
        </div>
        <div class="badge">
          <div class="badge-dot"></div>
          Interfaz activa
        </div>
      </div>

      <!-- Uploader -->
      <div class="uploader">
        <div class="uploader-label">1. Subí la póliza del cliente</div>
        <div class="uploader-text">
          PDF, DOCX o imagen legible. En producción se asocia a un ID de sesión o usuario.
        </div>
        <div class="uploader-row">
          <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" />
          <button class="btn" id="uploadBtn">Subir póliza</button>
        </div>
        <div id="uploadStatus"></div>
        <div id="uploadError"></div>
      </div>

      <!-- Chat -->
      <div class="chat-label">
        <div>
          <strong>2. Consultas sobre la póliza</strong><br>
          Preguntas sobre coberturas, exclusiones, límites, deducibles, condiciones particulares, etc.
        </div>
        <div style="font-size:8px; text-align:right;">
          Demo local. El análisis real se ejecuta en tu backend IA.
        </div>
      </div>

      <div id="noPolicy">Subí una póliza para responder en contexto.</div>

      <div id="chat">
        <div class="msg bot">
          Cargá una póliza y luego preguntá, por ejemplo:
          “¿Qué exclusiones aplican al robo de mercancía en esta póliza?”
        </div>
      </div>

      <div class="composer">
        <textarea
          id="input"
          rows="2"
          placeholder="Ejemplo: ¿Cuál es el deducible por daños por agua según esta póliza?"
        ></textarea>
        <button class="btn" id="send">Enviar</button>
      </div>

      <div class="typing" id="typing">
        <span></span><span></span><span></span>
        Analizando documento…
      </div>
    </section>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadStatus = document.getElementById('uploadStatus');
    const uploadError = document.getElementById('uploadError');
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const noPolicy = document.getElementById('noPolicy');
    const typing = document.getElementById('typing');

    let policyLoaded = false;

    function addMessage(text, type) {
      const div = document.createElement('div');
      div.className = 'msg ' + type;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    uploadBtn.addEventListener('click', () => {
      uploadStatus.textContent = '';
      uploadError.textContent = '';
      noPolicy.style.display = 'none';

      const file = fileInput.files[0];
      if (!file) {
        uploadError.textContent = 'Seleccioná un archivo para continuar.';
        return;
      }

      uploadBtn.disabled = true;

      // Demo: simulación de carga correcta.
      setTimeout(() => {
        policyLoaded = true;
        uploadStatus.textContent = `Póliza "${file.name}" registrada para esta sesión (demo).`;
        uploadBtn.disabled = false;
        addMessage(
          'La póliza fue cargada en esta sesión (modo demo). En producción se almacenaría en tu backend para análisis seguro.',
          'bot'
        );
      }, 500);
    });

    function buildDemoAnswer(question) {
      return (
        'Respuesta simulada basada en la póliza cargada.\n' +
        'En la versión real, el sistema:\n' +
        '- Extrae el texto de la póliza.\n' +
        '- Localiza las cláusulas relevantes.\n' +
        '- Devuelve una explicación clara, con referencias a secciones específicas.\n' +
        '\n' +
        'Todo gestionado desde tu backend, donde controlás seguridad, costos y reglas de negocio.'
      );
    }

    async function handleSend() {
      if (!policyLoaded) {
        noPolicy.style.display = 'block';
        return;
      }

      const text = input.value.trim();
      if (!text) return;

      addMessage(text, 'user');
      input.value = '';
      sendBtn.disabled = true;
      typing.style.display = 'inline-flex';

      setTimeout(() => {
        const answer = buildDemoAnswer(text);
        addMessage(answer, 'bot');
        sendBtn.disabled = false;
        typing.style.display = 'none';
      }, 600);
    }

    sendBtn.addEventListener('click', handleSend);

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        handleSend();
async function handleSend() {
  if (!policyLoaded) {
    noPolicy.style.display = 'block';
    return;
  }

  const text = input.value.trim();
  if (!text) return;

  addMessage(text, 'user');
  input.value = '';
  sendBtn.disabled = true;
  typing.style.display = 'inline-flex';

  try {
    const res = await fetch('https://policy-chat.TUUSUARIO.workers.dev', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: text })
    });

    if (!res.ok) throw new Error('Error en el servidor');

    const data = await res.json();
    addMessage(data.reply || 'Sin respuesta del servidor.', 'bot');
  } catch (err) {
    console.error(err);
    addMessage('Error al obtener respuesta. Revisá el Worker.', 'bot');
  } finally {
    sendBtn.disabled = false;
    typing.style.display = 'none';
  }
}
